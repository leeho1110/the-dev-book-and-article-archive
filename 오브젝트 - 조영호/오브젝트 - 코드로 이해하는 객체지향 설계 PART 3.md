# 오브젝트 PART 3 - 역할, 책임, 협력

### 협력

'객체지향의 사실과 오해'때부터 쭉 해왔던 객체지향 시스템은 자율적인 객체들의 공통체라는 말을 기억하는가.  객체들은 공통의 목적인 시스템의 기능을 서로의 협력을 통해 해결했다. 객체는 자신에게 할당된 책임을 수행할 때 자신이 해결하지 못하는 경우 적절한 객체에게 유일한 커뮤니케이션 수단인 메시지를 전송해 협력을 요청한다. 메시지를 수신한 객체가 해결할 수 없다면 위 과정을 다시 반복한다. 객체지향에서 객체들이 어떻게 일하는지를 아주 간단하게 세줄요약했다. 그리고 이를 가능케 하는 가장 기본적인 방법은 **캡슐화**였다는 것을 기억하자

---

### 협력이 설계를 위한 문맥을 결정한다

우리는 Movie 라는 객체를 상상할 때 대부분은 극장에서 영화를 상영하는 것을 상상한다. 따라서 당연히 play 라는 행동을 예상한다. 하지만 실제로는 그 어떤 실행과 관련된 메서드도 존재하지 않는다. Movie의 행동을 결정하는 것은 협력이다. 그리고 이 협력에서 Movie는 영화를 상영하는 것이 아닌 요금을 계산하는 책임을 갖는다. 협력이라는 문맥을 고려하지 않고서 행동을 결정하는 것은 아무런 의미가 없다.

객체의 행동을 결정하는 것이 협력이라면, 객체의 상태를 결정하는 것은 행동이다. 객체의 상태는 그 객체가 행동을 수행하는데 필요한 정보가 무엇인지로 결정된다. 상태는 객체가 행동하는데 필요한 정보에 의해 결정되고, 행동은 협력 안에서 객체가 처리할 메시지로 결정된다. 

결과적으로 객체가 참여하는 협력이 객체를 구성하는 행동과 상태 모두를 결정한다. 따라서 협력은 객체를 설계하는데 필요한 일종의 **문맥(context)**을 제공한다.

---

### 책임이란 무엇인가

객체는 협력에 필요한 행동을 수행하기 위해 존재한다. 그리고 협력에 참여하기 위해 객체가 수행하는 행동을 **책임**이라고 부른다. 이 때의 객체의 책임은 **‘하는 것(doing)’**과 **‘아는 것(knowing)’** 으로 세분화된다.

> ***하는 것***
> 
- 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
- 다른 객체의 행동을 시작시키는 것
- 다른 객체의 활동을 제어하고 조절하는 것

> ***아는 것***
> 
- 사적인 정보에 관해 아는 것
- 관련된 객체에 관해 아는 것
- 자신의 유도하거나 계산할 수 있는 것에 관해 아는 것

일반적으로 책임과 메시지의 크기는 다르다. 그 이유는 책임이 위처럼 아는 것과 하는 것이 구분되어있기 때문이다. 책임의 관점은 위 두 개와 밀접하게 연관되어 있다. 우리는 책임을 협력의 일부분을 수행하기 위한 역할 배분의 의미로 생각했지만 좀더 들어가보자면 수행하기 위해 필요한 정보들을 알고 있을 책임도 포함된다. 또한 책임은 그 크기에 따라 여러 개의 메시지로 분할되기도 하고 여러 객체들이 협력해야될 정도로 커지기도 한다.

협력이 중요한 이유는 객체에게 할당할 책임을 결정할 수 있는 문맥을 제공하기 때문이다. 그리고 우리는 이 협력에 필요한 책임들을 능숙하게 소프트웨어 객체에 할당하는 능력을 키워야 한다. 적절한 협력이 적절한 책임을 제공하고, 적절한 책임을 적절한 객체에게 할당해야만 단순하고 유연한 설계를 창조할 수 있다. 

---

### 책임 할당

자율적인 객체를 만드는 가장 기본적인 방법은 책임을 수행하는데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것이다. 이를 책임 할당을 위한 **INFORMATION EXPERT(정보 전문가) 패턴**이라고 부른다. 일상 생활에서도 찾아볼 수 있다. 우리는 옷을 수선하기 위해 집에서 리폼하기도 하지만 대부분은 수선집에 방문해 수선을 위탁하며, 우리보다 훨씬 해당 분야에 뛰어난 사람에게 위임한다. 어찌보면 이 패턴은 당연한 것이다.

다만 객체지향 세계에서는 누가 수선을 잘하는지 우리가 알고 있다. 따라서 협력이라는 문맥을 먼저 정의해 누가 수선을 잘하는지를 미리 파악해야 한다. 영화 예매 시스템을 예시로 들어보자. 우리는 영화를 예매하는 기능을 제공하려 한다. 따라서 시스템의 첫번째 책임은 영화를 예매하는 것이다. 이 때 객체의 유일한 커뮤니케이션 수단은 메시지이기 때문에 시스템이 전송하는 첫번째 메시지는 '예매하라'가 된다.

이 메시지는 누가 처리할까? 위에서 말했듯 수선을 잘하기 위한 배경지식이 풍부한 고수에게 맡기면 된다. 그렇다면 객체지향 세계에서는 누가 맡아야 할까. 영화 예매에 대한 정보를 가장 많이 알고있는 객체에게 책임을 할당하는 것이 바람직하다. 이처럼 객체지향 설계는 협력에 필요한 메시지(책임)을 찾고 이에 적절한 객체를 선택하는 과정을 반복하면 된다. 물론 결합도와 응집도 관점에서는 달라지는 경우도 있지만 기본적인 전략은 정보 전문가 패턴을 사용하면 된다. 이 원칙만 준수해도 상태와 행동을 함께 갖는 자율적인 객체를 만들 가능성은 충분히 높아진다.

---

### 책임 주도 설계

책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법을 **책임 주도 설계 (Responsibility-Driven Design, RDD)** 라고 부른다. 지금까지 해온 방법이다. 아래는 책임 주도 설계 방법의 과정이다. 여기서 우리는 협력이 책임을 이끌어내고, 책임(메시지)이 협력에 참여할 객체를 결정한다는 것을 기억해야 한다.

1. *시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.*
2. *시스템 책임을 더 작은 책임으로 분할한다.*
3. *분할된 책임을 수행할 수 있는  적절한 객체 또는 역할을 찾아 책임을 할당한다.*
4. *객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.*
5. *해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.*

---

### 메시지가 객체를 결정한다

우리는 객체에게 책임을 할당할 때 필요한 메시지를 먼저 식별하고 이 메시지를 처리할 객체를 나중에 선택하기로 했다. 객체가 메시지를 선택하는 것이 아닌 메시지가 객체를 선택하는 것에는 중요한 이유가 있다.

첫째, 객체가 최소한의 인터페이스(minimal interface)를 가질 수 있게 된다. 메시지가 객체를 선택하기 때문에 **객체는 적어도 하나, 그리고 꼭 필요한 퍼블릭 인터페이스**를 갖게 된다.

둘째, 객체는 충분히 추상적인 인터페이스(abstract interface)를 가진다. 인터페이스는 무엇(what)을 하는지 표현해야 하지만 어떻게(how) 수행하는지를 노출해서는 안된다. 

이를 통해 협력을 구성하는 객체들의 인터페이스는 충분히 추상적인 동시에 최소한의 크기를 유지할 수 있었다. 객체가 충분히 추상적이면서 미니멀리즘을 따르는 인터페이스를 가지게 하고 싶다면 메시지가 객체를 선택하게 하라.

---

### 행동이 상태를 결정한다

객체지향 패러다임에 갓 입문한 사람들이 가장 쉽게 빠지는 실수는 객체의 행동이 아니라 생테에 초점을 맞추는 것이다. 객체에 필요한 상태가 무엇인지 결정하고, 상태에 필요한 행동을 결정한다.

이는 객체의 내부 구현이 객체의 퍼블릭 인터페이스에 노출되도록 만들어 **캡슐화를 저해**한다. 이를 방지하기 위해선 항상 협력이라는 문맥 안에서 객체를 생각해야 한다. 상태는 행동을 수행하기 위한 재료일 뿐이다. 행동이 곧 객체의 책임이고 협력을 고려해야만 행동을 결정할 수 있다. 핵심은 행동이라는 것을 명심하자.

---

### 유연하고 재사용 가능한 협력

역할을 중요하게 바라본 이유가 무엇이었는지 기억하는가. 바로 재사용 가능한 협력을 얻을 수 있기 때문이었다. 우리는 이전 영화 예매 시스템에서 할인 정책 DiscountPolicy를 외부의 특정 객체(Amount, Percent)에 도움을 요청하는 것이 아닌 *할인 요금을 계산하라* 라는 메시지에 응답할 수 있는 대표자(DiscountPolicy 타입을 갖는 인스턴스 변수)에게 요청했다. 그리고 이 대표자는 정책에 따라 바꿔 끼워줄 수 있는 일종의 슬롯이었다. 이 슬롯이 바로 역할이다.

이 슬롯이 없었더라면 우리는 매번 각 할인 정책에 맞는 협력을 중복해서 구현했을 것이다. 하지만 할인정책이라는 역할이 있었기에 우리는 중복을 피하면서 두개의 협력을 유연하게 하나로 통합할 수 있었다.

---

### 객체 대 역할

방금 역할은 객체가 참여할 수 있는 일종의 슬롯이라고 했다. 하지만 이는 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 경우였고, 만약 한 가지의 객체만 협력에 참여하는 상황이라면? 이때의 슬롯의 후보는 객체가 된다. 

즉 협력에 적합한 책임을 수행하는 대상이 한 종류라면 객체로 간주하고, 여러 종류의 객체가 참여할 수 있다면 역할이라고 부르면 된다.

하지만 대부분의 상황에서는 이를 명확하게 분리하기 어렵다. 따라서 모든 것이 결정하기 힘든 상황이라면 우선 구체적인 객체로 시작하는 것이 좋다. 다양한 시나리오들을 탐색하며 유사한 협력들을 정리하다보면 자연스럽게 역할이 드러날 것이다.

---
